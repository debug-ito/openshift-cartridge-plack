#!/bin/bash

exit 0

## Code is borrowed from https://github.com/miyagawa/heroku-buildpack-perl/blob/master/bin/compile

source $OPENSHIFT_CARTRIDGE_SDK_BASH

pipe_client_message() {
    sed -u 's/^/CLIENT_MESSAGE:  /'
}


LIB_DIR="$OPENSHIFT_PLACK_DIR/local"

if ![ -d "$LIB_DIR" ]; then
    mkdir -p "$LIB_DIR"
fi

PATH="$LIB_DIR/bin:$PATH"

export PERL_CPANM_OPT="--quiet --notest -l '$LIB_DIR'"

cd "$OPENSHIFT_PLACK_DIR/usr"

if [ -e "$LIB_DIR/bin/cpanm" ]; then
    client_message "-----> Upgrading modules necessary for PLACK cartridge"
    cpanm --installdeps . 2>&1 | pipe_client_message
else
    client_message "-----> Installing modules necessary for PLACK cartridge"
    curl --silent https://raw.github.com/miyagawa/cpanminus/master/cpanm | perl - --installdeps . 2>&1 | pipe_client_message
fi

client_result "Cartrdige setup completed"

