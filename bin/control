#!/usr/bin/env perl

use strict;
use warnings;
use Daemon::Control;

sub standard_control {
    Daemon::Control->new({
        name => $ENV{OPENSHIFT_APP_NAME},
        program => "$ENV{OPENSHIFT_REPO_DIR}/local/bin/plackup",
        program_args => ["$ENV{OPENSHIFT_REPO_DIR}/app.psgi", "--port", "$ENV{OPENSHIFT_PLACK_PORT}"],
        ## init_config => "path/to/shell_script/to/set/environment",
        pid_file => "$ENV{OPENSHIFT_PLACK_DIR}/run/plackup.pid",
        fork => 2,
    })->run();
}

my $action = $ARGV[0];

if(!$action) {
    print "action is not specified\n";
    exit 1;
}

my %action_handler_for = (
    (map { $_ => \&standard_control } qw(start stop restart reload status)),
);

my $handler = $action_handler_for{$action};
if($handler) {
    $handler->();
}else {
    print "No handler for $action\n";
}
exit 0;
